<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dory Language Center - IELTS Practice Test</title>
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #0056b3;
            --background-color: #f4f4f9;
            --text-color: #333;
            --border-color: #ddd;
            --white: #fff;
            --success-color: #28a745;
            --success-color-dark: #218838;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        #test-container {
            width: 100%;
            max-width: 900px;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: var(--primary-color);
            color: var(--white);
            border-bottom: 3px solid var(--secondary-color);
        }

        .logo-container img {
            max-height: 50px;
            border-radius: 5px;
        }

        #timer {
            font-size: 1.2em;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        main {
            padding: 25px;
        }

        .hidden {
            display: none;
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-top: 0;
        }
        
        h3 {
            color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 25px;
        }

        p {
            line-height: 1.6;
        }
        
        .screen-description {
             text-align: center;
             font-size: 1.1em;
             color: #555;
             margin-bottom: 30px;
        }

        #info-form-screen form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 500px;
            margin: 20px auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        #section-selection-screen {
            text-align: center;
        }

        .section-btn-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-color);
            color: var(--white);
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #submit-btn, .submit-form-btn, #restart-btn {
            background-color: var(--success-color);
        }
        #submit-btn:hover, .submit-form-btn:hover, #restart-btn:hover {
            background-color: var(--success-color-dark);
        }

        #question-navigation-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            justify-content: center;
        }

        .nav-q-btn {
            min-width: 100px;
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background-color: var(--white);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .nav-q-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        .nav-q-btn.current {
            background-color: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .nav-q-btn.answered {
            background-color: var(--success-color);
            color: var(--white);
            border-color: var(--success-color-dark);
        }

        #question-area .question-card {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
            background: #fdfdfd;
        }

        p.instructions {
            font-style: italic;
            background-color: #e9f7ff;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
            margin: 20px 0;
            line-height: 1.5;
        }

        .passage {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.1em;
            line-height: 1.7;
            border: 1px solid #e9ecef;
            text-align: justify;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .options-container label {
            display: block;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .options-container label:hover {
            background-color: #e9ecef;
        }
        
        .options-container input:checked + span {
            font-weight: bold;
            color: var(--secondary-color);
        }

        textarea.writing-input {
            width: 98%;
            height: 300px;
            padding: 10px;
            font-size: 1em;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            resize: vertical;
            line-height: 1.6;
        }
        
        textarea.writing-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .html-template-container {
            padding: 15px;
            line-height: 2.2;
        }

        .html-template-container input[type="text"],
        .html-template-container select {
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-bottom-width: 2px;
            border-radius: 4px;
            font-size: 0.95em;
            margin: 0 5px;
            width: 150px;
            display: inline-block;
            vertical-align: baseline;
        }
        .html-template-container select {
            width: auto;
            min-width: 120px;
        }
        
        .html-template-container input[type="text"]:focus,
        .html-template-container select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .matching-options-box {
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }
        .matching-options-box ul {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }
        .matching-stem-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 4px;
        }
        .matching-stem-item:nth-child(odd) {
            background-color: #fdfdfd;
        }
        .matching-stem-item label {
            flex-grow: 1;
        }
        .matching-stem-item select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .question-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 15px auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        #test-navigation {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            margin-top: 20px;
        }
        
        #audio-player-container {
            margin-bottom: 20px;
            text-align: center;
        }
        
        #audio-player {
            width: 100%;
        }
        
        #result-screen table {
            width: 100%;
            border-collapse: collapse; 
            margin-top: 15px;
        }
        
        #result-screen th, #result-screen td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        #result-screen th {
            background-color: #f2f2f2;
            color: var(--secondary-color);
        }
        
        #result-screen tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        #result-screen .result-summary {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
        }
        
        #result-screen .result-summary p {
            margin: 0;
            padding: 15px;
            border-radius: 8px;
            color: var(--white);
        }
        
        .result-summary .correct { background-color: var(--success-color);
        }
        .result-summary .incorrect { background-color: #dc3545;
        }
        .result-summary .unanswered { background-color: #6c757d;
        }


        footer {
            text-align: center;
            padding: 20px;
            background-color: #e9ecef;
            font-size: 0.9em;
            color: #6c757d;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div id="test-container">
        <header>
            <div class="logo-container">
                <img src="https://placehold.co/150x50/007BFF/FFFFFF?text=Dory+Center" alt="Dory Language Center Logo">
            </div>
            <div id="timer">Time Left: 00:00</div>
        </header>

        <main id="main-content">
     
            <div id="test-selection-screen">
                <h1>Welcome to the IELTS Practice Test</h1>
                <p class="screen-description">Please select a test set to begin.</p>
                <div class="form-group" style="max-width: 500px; margin: auto;">
          
                   <label for="test-set-select">Select Test Set:</label>
                    <select id="test-set-select" class="custom-select"></select>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button id="start-test-btn" class="hidden">Start Test</button>
      
                   </div>
            </div>
            
            <div id="info-form-screen" class="hidden">
                <h2>Student Information</h2>
                <p 
 class="screen-description">Please fill out your details before starting.</p>
                <form id="student-info-form">
                    <div class="form-group">
                        <label for="fullName">Full Name:</label>
                        <input type="text" id="fullName" name="fullName" required>
  
                   </div>
                    <div class="form-group">
                        <label for="className">Class:</label>
                        <input type="text" id="className" name="className" required>
        
             </div>
                    <div class="form-group">
                        <label for="dob">Test Date:</label>
                        <input type="date" id="dob" name="dob" required>
             
               </div>
                    <div class="form-group">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" name="phone" required>
                  
                     </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
    
                 <div style="text-align: center;
 margin-top: 20px;">
                        <button type="submit" class="submit-form-btn">Continue to Test</button>
                    </div>
                </form>
            </div>

            <div id="section-selection-screen" class="hidden">
                <h2 id="selected-test-name"></h2>
                <p class="screen-description">Please select a section to begin.</p>
                <div class="section-btn-container">
                    <button class="section-btn" data-section="listening">Listening</button>              
                    <button class="section-btn" data-section="reading">Reading</button>
                    <button class="section-btn" data-section="writing">Writing</button>
                </div>
            </div>

            <div id="test-screen" class="hidden">
            
                 <h2 id="section-title"></h2>
                <div id="audio-player-container"></div> 
                <div id="question-navigation-bar"></div>
                <div id="question-area"></div>
                <div id="test-navigation">
                    <button id="prev-btn">Previous</button>
     
                    <button id="next-btn">Next</button>
                    <button id="submit-btn">Submit Section</button>
                </div>
            </div>

            <div id="result-screen" class="hidden">
   
                 <div id="result-content"></div>
                <div style="text-align: center;
 margin-top: 30px;">
                    <button id="restart-btn">Return to Home</button>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 Dory Language Center - IELTS Practice Platform</p>
        </footer>
    
     </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Test Data (Embedded from PDF) ---
        const embeddedTestData = {
          "testSets": [
            {
              "setName": "Cambridge 19 - Test 2",
              "listening": {
  
               "title": "Listening",
                "timeLimit": 2400, // 40 minutes (30 for listening, 10 for transfer)
                "parts": [
                  {
       
                   "partTitle": "PART 1, Questions 1-10",
                    "audio": "audio/Test2_Part1.mp3",
                    "type": "html_template",
                    "instructions": "Complete the form and table below.<br>Write <strong>ONE WORD AND/OR A NUMBER</strong> for each answer for questions 1-6.<br>Write <strong>ONE WORD ONLY</strong> for questions 7-10.",
                    "html_template": `
                        <h3>Guitar Group</h3>
                        <p><strong>Coordinator:</strong> Gary [BLANK_1]</p>
                      
                     <p><strong>Level:</strong> [BLANK_2]</p>
                        <p><strong>Place:</strong> the [BLANK_3] [BLANK_4] Street</p>
                        <p><strong>First floor, Room:</strong> T347</p>
                        <p><strong>Time:</strong> Thursday morning at [BLANK_5]</p>
              
                       <p><strong>Recommended website:</strong> 'The perfect [BLANK_6]'</p>
                        <br>
                        <h4>A typical 45-minute guitar lesson</h4>
                        <table style="width:100%;
 border-collapse: collapse;">
                          <tr style="background:#f2f2f2;">
                            <th style="border:1px solid #ddd;
 padding:8px;">Time</th><th style="border:1px solid #ddd; padding:8px;">Activity</th><th style="border:1px solid #ddd; padding:8px;">Notes</th>
                          </tr>
                          <tr><td style="border:1px solid #ddd;
 padding:8px;">5 minutes</td><td style="border:1px solid #ddd; padding:8px;">tuning guitars</td><td style="border:1px solid #ddd;
 padding:8px;">using an app or by [BLANK_7]</td></tr>
                          <tr><td style="border:1px solid #ddd;
 padding:8px;">10 minutes</td><td style="border:1px solid #ddd; padding:8px;">strumming chords using our thumbs</td><td style="border:1px solid #ddd;
 padding:8px;">keeping time while the teacher is [BLANK_8]</td></tr>
                          <tr><td style="border:1px solid #ddd;
 padding:8px;">15 minutes</td><td style="border:1px solid #ddd; padding:8px;">playing songs</td><td style="border:1px solid #ddd;
 padding:8px;">often listening to a [BLANK_9] of a song</td></tr>
                          <tr><td style="border:1px solid #ddd;
 padding:8px;">10 minutes</td><td style="border:1px solid #ddd; padding:8px;">playing single notes and simple tunes</td><td style="border:1px solid #ddd;
 padding:8px;">playing together, then [BLANK_10]</td></tr>
                           <tr><td style="border:1px solid #ddd;
 padding:8px;">5 minutes</td><td style="border:1px solid #ddd; padding:8px;">noting things to practise at home</td><td style="border:1px solid #ddd;
 padding:8px;"></td></tr>
                        </table>`,
                    "questions": [
                      {"id": 1, "answer": "Fieldman"}, {"id": 2, "answer": "beginners"},
                      {"id": 3, "answer": "community"}, 
 {"id": 4, "answer": "centre"},
                      {"id": 5, "answer": "10.30"}, {"id": 6, "answer": "guitarist"},
                      {"id": 7, "answer": "ear"}, {"id": 8, "answer": "singing"},
                      {"id": 9, "answer": "recording"}, {"id": 10, "answer": "alone"}
          
                   ]
                  },
                  {
                    "partTitle": "PART 2, Questions 11-20",
                    "audio": "audio/Test2_Part2.mp3",
                    "questions": [
         
                       {
                        "id": 11, "type": "single_question_list", "instructions": "Questions 11-16: Choose the correct letter, A, B or C.",
                        "questionText": "11. What made David leave London and move to Northsea?",
                        "options": ["A. He was eager to develop a hobby.", "B. He wanted to work shorter hours.", "C. He found his job in website design unsatisfying."],
                        "answer": "C"
                      },
                      {
                        
 "id": 12, "type": "single_question_list",
                        "questionText": "12. The Lifeboat Institution in Northsea was built with money provided by",
                        "options": ["A. a local organisation.", "B. a local resident.", "C. the local council."],
                        "answer": "B"
                      },
                      {
                     
                       "id": 13, "type": "single_question_list",
                        "questionText": "13. In his health assessment, the doctor was concerned about the fact that David",
                        "options": ["A. might be colour blind.", "B. was rather short-sighted.", "C. had undergone eye surgery."],
                        "answer": "A"
                      },
                      {
                   
                         "id": 14, "type": "single_question_list",
                        "questionText": "14. After arriving at the lifeboat station, they aim to launch the boat within",
                        "options": ["A. five minutes.", "B. six to eight minutes.", "C. eight and a half minutes."],
                        "answer": "A"
                      },
                      {
                   
                         "id": 15, "type": "single_question_list",
                        "questionText": "15. As a 'helmsman', David has the responsibility of deciding",
                        "options": ["A. who will be the members of his crew.", "B. what equipment it will be necessary to take.", "C. if the lifeboat should be launched."],
                        "answer": "C"
                      },
                      {
                        "id": 16, 
                         "type": "single_question_list",
                        "questionText": "16. As well as going out on the lifeboat, David",
                        "options": ["A. gives talks on safety at sea.", "B. helps with fundraising.", "C. recruits new volunteers."],
                        "answer": "A"
                      },
                      {
                        "id": [17, 18], "type": "single_question_list", 
                         "multiSelect": true, "instructions": "Questions 17 and 18: Choose TWO letters, A-E.<br>Which TWO things does David say about the lifeboat volunteer training?",
                        "options": ["A. The residential course developed his leadership skills.", "B. The training in use of ropes and knots was quite brief.", "C. The training exercises have built up his mental strength.", "D. The casualty care activities were particularly challenging for him.", "E. The wave tank activities provided practice in survival techniques."],
                        "answer": ["C", "E"]
                      },
                      {
                      
                       "id": [19, 20], "type": "single_question_list", "multiSelect": true, "instructions": "Questions 19 and 20: Choose TWO letters, A-E.<br>Which TWO things does David find most motivating about the work he does?",
                        "options": ["A. working as part of a team", "B. experiences when working in winter", "C. being thanked by those he has helped", "D. the fact that it keeps him fit", "E. the chance to develop new equipment"],
                        "answer": ["A", "C"]
                      }
                    ]
                  },
         
                   {
                    "partTitle": "PART 3, Questions 21-30",
                    "audio": "audio/Test2_Part3.mp3",
                    "questions": [
                      {
                        
 "id": 21, "type": "single_question_list", "instructions": "Questions 21-24: Choose the correct letter, A, B or C.",
                        "questionText": "21. At first, Don thought the topic of recycling footwear might be too",
                        "options": ["A. limited in scope.", "B. hard to research.", "C. boring for listeners."],
                        "answer": "C"
                      },
                      {
                     
                       "id": 22, "type": "single_question_list",
                        "questionText": "22. When discussing trainers, Bella and Don disagree about",
                        "options": ["A. how popular they are among young people.", "B. how suitable they are for school.", "C. how quickly they wear out."],
                        "answer": "B"
                      },
                      {
                        "id": 23, "type": 
 "single_question_list",
                        "questionText": "23. Bella says that she sometimes recycles shoes because",
                        "options": ["A. they no longer fit.", "B. she no longer likes them.", "C. they are no longer in fashion."],
                        "answer": "A"
                      },
                      {
                        "id": 24, 
 "type": "single_question_list",
                        "questionText": "24. What did the article say that confused Don?",
                        "options": ["A. Public consumption of footwear has risen.", "B. Less footwear is recycled now than in the past.", "C. People dispose of more footwear than they used to."],
                        "answer": "B"
                      },
                      {
                       
                     "id": [25, 26, 27, 28], "type": "matching_inline", "instructions": "Questions 25-28: What reasons did the recycling manager give for rejecting footwear, according to the students?<br>Choose FOUR answers from the box and write the correct letter, A-F, next to Questions 25-28.",
                        "options": [
                          {"value": "A", "text": "A. one shoe was missing"},
                          {"value": "B", "text": "B. the colour of one shoe had faded"},
                          {"value": "C", "text": "C. one shoe had a hole in it"},
                          {"value": "D", "text": "D. the shoes were brand new"},
                          {"value": "E", "text": "E. the shoes were too dirty"},
                          {"value": "F", "text": "F. the stitching on the shoes was broken"}
                        ],
                        "matching_questions": [
                          {"id": 25, "questionText": "25. the high-heeled shoes", "answer": "E"},
                          {"id": 26, "questionText": "26. the ankle boots", "answer": "A"},
                          {"id": 27, "questionText": "27. the baby shoes", "answer": "F"},
                          {"id": 28, "questionText": "28. the trainers", "answer": "C"}
                        ]
                      },
                      {
                        "id": 29, "type": "single_question_list", "instructions": 
 "Questions 29-30: Choose the correct letter, A, B or C.",
                        "questionText": "29. Why did the project to make 'new' shoes out of old shoes fail?",
                        "options": ["A. People believed the 'new' pairs of shoes were unhygienic.", "B. There were not enough good parts to use in the old shoes.", "C. The shoes in the 'new' pairs were not completely alike."],
                        "answer": "C"
                      },
                      {
                      
                       "id": 30, "type": "single_question_list",
                        "questionText": "30. Bella and Don agree that they can present their topic",
                        "options": ["A. from a new angle.", "B. with relevant images.", "C. in a straightforward way."],
                        "answer": "A"
                      }
                    ]
                  },
   
                   {
                    "partTitle": "PART 4, Questions 31-40",
                    "audio": "audio/Test2_Part4.mp3",
                    "type": "html_template",
                    "instructions": "Complete the notes below.<br>Write <strong>ONE WORD ONLY</strong> for each answer.",
                    "html_template": `
                        <h3>Tardigrades</h3>
                        <p>more than 1,000 species, 0.05-1.2 millimetres long</p>
                   
                         <ul>
                          <li>also known as water 'bears' (due to how they <strong>31</strong> [BLANK_31]) or 'moss piglets'</li>
                        </ul>
                        <h4>Physical appearance</h4>
       
                         <ul>
                          <li>a <strong>32</strong> [BLANK_32] round body and four pairs of legs</li>
                          <li>claws or <strong>33</strong> [BLANK_33] for gripping</li>
                 
                           <li>absence of respiratory organs</li>
                          <li>body filled with a liquid that carries both <strong>34</strong> [BLANK_34] and blood</li>
                          <li>mouth shaped like a <strong>35</strong> [BLANK_35] with teeth called stylets</li>
                
                         </ul>
                        <h4>Habitat</h4>
                        <ul>
                          <li>often found at the bottom of a lake or on plants</li>
        
                           <li>very resilient and can exist in very low or high <strong>36</strong> [BLANK_36]</li>
                        </ul>
                        <h4>Cryptobiosis</h4>
                       
                         <ul>
                          <li>In dry conditions, they roll into a ball called a 'tun'.</li>
                          <li>They stay alive with a much lower metabolism than usual.</li>
                          <li>A type 
 of <strong>37</strong> [BLANK_37] ensures their DNA is not damaged.</li>
                          <li>Research is underway to find out how many days they can stay alive in <strong>38</strong> [BLANK_38]</li>
                        </ul>
                        <h4>Feeding</h4>
   
                         <ul>
                          <li>consume liquids, e.g., those found in moss or <strong>39</strong> [BLANK_39]</li>
                          <li>may eat other tardigrades</li>
               
                         </ul>
                        <h4>Conservation status</h4>
                        <ul>
                          <li>They are not considered to be <strong>40</strong> [BLANK_40]</li>
         
                         </ul>`,
                    "questions": [
                      {"id": 31, "answer": "walk"}, {"id": 32, "answer": "short"},
                      {"id": 33, "answer": "pads"}, {"id": 34, "answer": "oxygen"},
      
                     {"id": 35, "answer": "tube"}, {"id": 36, "answer": "temperatures"},
                      {"id": 37, "answer": "protein"}, {"id": 38, "answer": "space"},
                      {"id": 39, "answer": "algae"}, {"id": 40, "answer": "endangered"}
                   
                     ]
                  }
                ]
              },
              "reading": {
                "title": "Academic Reading",
                "timeLimit": 3600, 
 // 60 minutes
                "parts": [
                  {
                    "partTitle": "Passage 1",
                    "passage": "The Industrial Revolution began in Britain in the mid-1700s and by the 1830s and 1840s had spread to many other  parts of the world, including the United States. In Britain, it was a period when a largely rural, agrarian society was transformed into an industrialised, urban one.\n\nGoods that had once been crafted by hand started to be produced in mass quantities by machines in factories, thanks to the invention of steam power and the introduction of new machines and manufacturing techniques in textiles, iron-making and other industries.\n\nThe foundations of the Industrial Revolution date back to the early 1700s, when the English inventor Thomas Newcomen designed the first modern steam engine.\n\nCalled the 'atmospheric steam engine', Newcomen's invention was originally used to power machines that pumped water out of mines.\n\nIn the 1760s, the Scottish engineer James Watt started to adapt one of Newcomen's models, and succeeded in making it far more efficient.\n\nWatt later worked with the English manufacturer Matthew Boulton to invent a new steam engine driven by both the forward and backward strokes of the piston, while the gear mechanism it was connected to produced rotary motion.\n\nIt was a key innovation that would allow steam power to spread across British industries.\n\nThe demand for coal, which was a relatively cheap energy source, grew rapidly during the Industrial Revolution, as it was needed to run not only the factories used to produce manufactured goods, but also steam-powered transportation.\n\nIn the early 1800s, the English engineer Richard Trevithick built a steam-powered locomotive, and by 1830 goods and passengers were being transported between the industrial centres of Manchester and Liverpool.\n\nIn addition, steam-powered boats and ships were widely used to carry goods along Britain's canals as well as across the Atlantic.\n\nBritain had produced textiles like wool, linen and cotton, for hundreds of years, but prior to the Industrial Revolution, the British textile business was a true 'cottage industry', with the work performed in small workshops or even homes by individual spinners, weavers and dyers.\n\nStarting in the mid-1700s, innovations like the spinning jenny and the power loom made weaving cloth and spinning yarn and thread much easier.\n\nWith these machines, relatively little labour was required to produce cloth, and the new, mechanised textile factories that opened around the country were quickly able to meet customer demand for cloth both at home and abroad.\n\nThe British iron industry also underwent major change as it adopted new innovations.\n\nChief among the new techniques was the smelting of iron ore with coke (a material made by heating coal) instead of the traditional charcoal.\n\nThis method was cheaper and produced metals that were of a higher quality, enabling Britain's iron and steel production to expand in response to demand created by the Napoleonic Wars (1803-15) and the expansion of the railways from the 1830s.\n\nThe latter part of the Industrial Revolution also saw key advances in communication methods, as people increasingly saw the need to communicate efficiently over long distances.\n\nIn 1837, British inventors William Cooke and Charles Wheatstone patented the first commercial telegraphy system.\n\nIn the 1830s and 1840s, Samuel Morse and other inventors worked on their own versions in the United States.\n\nCooke and Wheatstone's system was soon used for railway signalling in the UK.\n\nAs the speed of the new locomotives increased, it was essential to have a fast and effective means of avoiding collisions.\n\nThe impact of the Industrial Revolution on people's lives was immense.\n\nAlthough many people in Britain had begun moving to the cities from rural areas before the Industrial Revolution, this accelerated dramatically with industrialisation, as the rise of large factories turned smaller towns into major cities in just a few decades.\n\nThis rapid urbanisation brought significant challenges, as overcrowded cities suffered from pollution and inadequate sanitation.\n\nAlthough industrialisation increased the country's economic output overall and improved the standard of living for the middle and upper classes, many poor people continued to struggle.\n\nFactory workers had to work long hours in dangerous conditions for extremely low wages.\n\nThese conditions along with the rapid pace of change fuelled opposition to industrialisation.\n\nA group of British workers who became known as 'Luddites' were British weavers and textile workers who objected to the increased use of mechanised looms and knitting frames.\n\nMany had spent years learning their craft, and they feared that unskilled machine operators were robbing them of their livelihood.\n\nA few desperate weavers began breaking into factories and smashing textile machines.\n\nThey called themselves Luddites after Ned Ludd, a young apprentice who was rumoured to have wrecked a textile machine in 1779.\n\nThe first major instances of machine breaking took place in 1811 in the city of Nottingham, and the practice soon spread across the country.\n\nMachine-breaking Luddites attacked and burned factories, and in some cases they even exchanged gunfire with company guards and soldiers.\n\nThe workers wanted employers to stop installing new machinery, but the British government responded to the uprisings by making machine-breaking punishable by death.\n\nThe unrest finally reached its peak in April 1812, when a few Luddites were shot during an attack on a mill near Huddersfield.\n\nIn the days that followed, other Luddites were arrested, and dozens were hanged or transported to Australia.\n\nBy 1813, the Luddite resistance had all but vanished."
                  },
                  {
                    "partTitle": "Questions 1-7",
                    "type": "html_template",
             
                   "instructions": "Complete the notes below.<br>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.",
                    "html_template": `
                        <h3>Britain's Industrial Revolution</h3>
                        <h4>Steam power</h4>
                   
                         <ul>
                            <li>Newcomen's steam engine was used in mines to remove water.</li>
                            <li>In Watt and Boulton's steam engine, the movement of the <strong>1</strong> [BLANK_1] was linked to a gear system.</li>
             
                           <li>A greater supply of <strong>2</strong> [BLANK_2] was required to power steam engines.</li>
                        </ul>
                        <h4>Textile industry</h4>
                        <ul>
 
                            <li>Before the Industrial Revolution, spinners and weavers worked at home and in <strong>3</strong> [BLANK_3].</li>
                            <li>Not as much <strong>4</strong> [BLANK_4] was needed to produce cloth once the spinning jenny and power loom were invented.</li>
              
                       </ul>
                        <h4>Iron industry</h4>
                        <ul>
                            <li>Smelting of iron ore with coke resulted in material that was better <strong>5</strong> 
 [BLANK_5].</li>
                            <li>Demand for iron increased with the growth of the <strong>6</strong> [BLANK_6].</li>
                        </ul>
                        <h4>Communications</h4>
              
                       <ul>
                            <li>Cooke and Wheatstone patented the first telegraphy system.</li>
                            <li>The telegraphy system was used to prevent locomotives colliding.</li>
                   
                         </ul>
                        <h4>Urbanisation</h4>
                        <ul>
                            <li>Small towns turned into cities very quickly.</li>
             
                           <li>The new cities were dirty, crowded and lacked sufficient <strong>7</strong> [BLANK_7].</li>
                        </ul>`,
                    "questions": [
                      {"id": 1, "answer": "piston"}, {"id": 2, "answer": "coal"},
 
                      {"id": 3, "answer": "workshops"}, {"id": 4, "answer": "labour"},
                      {"id": 5, "answer": "quality"}, {"id": 6, "answer": "railways"},
                      {"id": 7, "answer": "sanitation"}
                  
                   ]
                  },
                  {
                    "partTitle": "Questions 8-13",
                    "type": "single_question_list",
                   
                     "instructions": "Do the following statements agree with the information given in Reading Passage 1?<br>Write <strong>TRUE</strong>, <strong>FALSE</strong>, or <strong>NOT GIVEN</strong>.",
                    "questions": [
                      {"id": 8, "questionText": "8. Britain's canal network grew rapidly so that more goods could be transported around the country.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "NOT GIVEN"},
                      {"id": 9, "questionText": "9. Costs in the iron industry rose when the technique of smelting iron ore with coke was introduced.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "FALSE"},
                      {"id": 10, "questionText": "10. Samuel Morse's communication system was more reliable than that developed by William Cooke and Charles Wheatstone.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "NOT GIVEN"},
                      {"id": 11, "questionText": "11. The economic benefits of industrialisation were limited to certain sectors of society.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "TRUE"},
                      {"id": 12, "questionText": "12. Some skilled weavers believed that the introduction of the new textile machines would lead to job losses.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "TRUE"},
                      {"id": 13, "questionText": "13. There was some sympathy among local people for the Luddites who were arrested near Huddersfield.", "options": ["TRUE", "FALSE", "NOT GIVEN"], "answer": "NOT GIVEN"}
                    ]
                  },
                  {
                    "partTitle": "Passage  2",
                    "passage": "A. It isn't easy being a professional athlete. Not only are the physical demands greater than most people could handle, athletes also face intense psychological pressure during competition. This is something that British tennis player Emma Raducanu wrote about on social media following her withdrawal from the 2021 Wimbledon tournament. Though the young player had been doing well in the tournament, she began having difficulty regulating her breathing and heart rate during a match, which she later attributed to 'the accumulation of the excitement and the buzz'.\n\nB. For athletes, some level of performance stress is almost unavoidable. But there are many different factors that dictate just how people's minds and bodies respond to stressful events. Typically, stress is the result of an exchange between two factors: demands and resources. An athlete may feel stressed about an event if they feel the demands on them are greater than they can handle. These demands include the high level of physical and mental effort required to succeed, and also the athlete's concerns about the difficulty of the event, their chance of succeeding, and any potential dangers such as injury. Resources, on the other hand, are a person's ability to cope with these demands. These include factors such as the competitor's degree of confidence, how much they believe they can control the situation's outcome, and whether they're looking forward to the event or not.\n\nC. Each new demand or change in circumstances affects whether a person responds positively or negatively to stress. Typically, the more resources a person feels they have in handling the situation, the more positive their stress response. This positive stress response is called a challenge state. But should the person feel there are too many demands placed on them, the more likely they are to experience a negative stress response - known as a threat state. Research shows that the challenge states lead to good performance, while threat states lead to poorer performance. So, in Emma Raducanu's case, a much larger audience, higher expectations and facing a more skilful opponent, may all have led her to feel there were greater demands being placed on her at Wimbledon - but she didn't have the resources to tackle them. This led to her experiencing a threat response.\n\nD. Our challenge and threat responses essentially influence how our body responds to stressful situations, as both affect the production of adrenaline and cortisol - also known as 'stress hormones'. During a challenge state, adrenaline increases the amount of blood pumped from the heart and expands the blood vessels, which allows more energy to be delivered to the muscles and brain. This increase of blood and decrease of pressure in the blood vessels has been consistently related to superior sport performance in everything from cricket batting, to golf putting and football penalty taking. But during a threat state, cortisol inhibits the positive effect of adrenaline, resulting in tighter blood vessels, higher blood pressure, slower psychological responses, and a faster heart rate. In short, a threat state makes people more anxious - they make worse decisions and perform more poorly. In tennis players, cortisol has been associated with more unsuccessful serves and greater anxiety.\n\nE. That said, anxiety is also a common experience for athletes when they're under pressure. Anxiety can increase heart rate and perspiration, cause heart palpitations, muscle tremors and shortness of breath, as well as headaches, nausea, stomach pain, weakness and a desire to escape in more extreme cases. Anxiety can also reduce concentration and self-control and cause overthinking. The intensity with which a person experiences anxiety depends on the demands and resources they have. Anxiety may also manifest itself in the form of excitement or nervousness depending on the stress response. Negative stress responses can be damaging to both physical and mental health - and repeated episodes of anxiety coupled with negative responses can increase risk of heart disease and depression.\n\nF. But there are many ways athletes can ensure they respond positively under pressure. Positive stress responses can be promoted through the language that they and others - such as coaches or parents - use. Psychologists can also help athletes change how they see their physiological responses - such as helping them see a higher heart rate as excitement, rather than nerves. Developing psychological skills, such as visualisation, can also help decrease physiological responses to threat. Visualisation may involve the athlete recreating a mental picture of a time when they performed well, or picturing themselves doing well in the future. This can help create a feeling of control over the stressful event. Recreating competitive pressure during training can also help athletes learn how to deal with stress. An example of this might be scoring athletes against their peers to create a sense of competition. This would increase the demands which players experience compared to a normal training session, while still allowing them to practise coping with stress."
                },
                  {
                    "partTitle": "Questions 14-18",                  
                     "type": "matching_inline",
                    "instructions": "Reading Passage 2 has six paragraphs, A-F.<br>Which paragraph contains the following information? NB You may use any letter more than once.",
                    "options": [
                      {"value": "A", "text": "A "}, {"value": "B", "text": "B"},
                      {"value": "C", "text": "C "}, {"value": "D", "text": "D"},
       
                      {"value": "E", "text": "E"}, {"value": "F", "text": "F"}
                    ],
                    "matching_questions": [
                      {"id": 14, "questionText": "14. reference to two chemical compounds which impact on performance", "answer": "D"},
                      {"id": 15, "questionText": "15. examples of strategies for minimising the effects of stress", "answer": "F"},
                      {"id": 16, "questionText": "16. how a sportsperson accounted for their own experience of stress", "answer": "A"},
                      {"id": 17, "questionText": "17. study results indicating links between stress responses and performance", "answer": "C"},
                      {"id": 18, "questionText": "18. mention of people who can influence how athletes perceive their stress responses", "answer": "F"}
                    ]
                  },
                  {
                    "partTitle": "Questions 19-22",
         
                     "type": "html_template",
                    "instructions": "Complete the sentences below.<br>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.",
                    "html_template": `
                        <p>19. Performance stress involves many demands on the athlete, for example, coping with the possible risk of [BLANK_19].</p>
                        <p>20. Cortisol can cause tennis 
 players to produce fewer good [BLANK_20].</p>
                        <p>21. Psychologists can help athletes to view their physiological responses as the effect of a positive feeling such as [BLANK_21].</p>
                        <p>22. [BLANK_22] is an example of a psychological technique which can reduce an athlete's stress responses.</p>`,
             
                     "questions": [
                      {"id": 19, "answer": "injury"}, {"id": 20, "answer": "serves"},
                      {"id": 21, "answer": "excitement"}, {"id": 22, "answer": "visualisation"}
                    ]
              
                 },
                  {
                    "partTitle": "Questions 23-26",
                    "type": "single_question_list",
                    "questions": [
              
                     {
                        "id": [23, 24], "multiSelect": true, "instructions": "Questions 23 and 24: Choose TWO letters, A-E.<br>Which TWO facts about Emma Raducanu's withdrawal from the Wimbledon tournament are mentioned in the text?",
                        "options": [
                          "A. the stage at which she dropped out of the tournament",
                          "B. symptoms of her performance stress at the tournament",
                          "C. measures which she had taken to manage her stress levels",
                          "D. aspects of the Wimbledon tournament which increased her stress levels",
                          "E. reactions to her social media posts about her experience at Wimbledon"
                        ],
                        "answer": ["B", "D"]
                      },
                  
                     {
                        "id": [25, 26], "multiSelect": true, "instructions": "Questions 25 and 26: Choose TWO letters, A-E.<br>Which TWO facts about anxiety are mentioned in Paragraph E of the text?",
                        "options": [
                          "A. the factors which determine how severe it may be",
                          "B. how long it takes for its effects to become apparent",
                          "C. which of its symptoms is most frequently encountered",
                          "D. the types of athletes who are most likely to suffer from it",
                          "E. the harm that can result if athletes experience it too often"
                        ],
                        "answer": ["A", "E"]
                      }
                  
                   ]
                  },
                  {
                    "partTitle": "Passage 3",
                    "passage": "Let us start by looking at a modern 'genius', Maryam Mirzakhani, who died at the early age of 40. She was the only woman to win the Fields Medal - the mathematical equivalent of a Nobel prize.It would be easy to assume that someone as special as Mirzakhani must have been one of those 'gifted children, those who have an extraordinary ability in a specific sphere of activity or knowledge.But look closer and a different story emerges. Mirzakhani was born in Tehran, Iran.She went to a highly selective girls' school but maths wasn't her interest - reading was.She loved novels and would read anything she could lay her hands on.As for maths, she did rather poorly at it for the first couple of years in her middle school, but became interested when her elder brother told her about what he'd learned.He shared a famous maths problem from a magazine that fascinated her and she was hooked.\n\nIn adult life it is clear that she was curious, excited by what she did and also resolute in the face of setbacks.One of her comments sums it up. 'Of course, the most rewarding part is the \"Aha\" moment, the excitement of discovery and enjoyment of understanding something new... But most of the time, doing mathematics for me is like being on a long hike with no trail and no end in sight.That trail took her to the heights of original research into mathematics.\n\nIs her background unusual? Apparently not.Most Nobel prize winners were unexceptional in childhood. Einstein was slow to talk as a baby.He failed the general part of the entry test to Zurich Polytechnic though they let him in because of high physics and maths scores.He struggled at work initially, but he kept plugging away and eventually rewrote the laws of Newtonian mechanics with his theory of relativity.\n\nThere has been a considerable amount of research on high performance over the last century that suggests it goes way beyond tested intelligence.On top of that, research is clear that brains are flexible, new neural pathways can be created, and IQ isn't fixed.For example, just because you can read stories with hundreds of pages at the age of five doesn't mean you will still be ahead of your contemporaries in your teens.\n\nWhile the jury is out on giftedness being innate and other factors potentially making the difference, what is certain is that the behaviours associated with high levels of performance are replicable and most can be taught even traits such as curiosity.\n\nAccording to my colleague Prof Deborah Eyre, with whom I've collaborated on the book Great Minds and How to Grow Them, the latest neuroscience and psychological research suggests most individuals can reach levels of performance associated in school with the gifted and talented.However, they must be taught the right attitudes and approaches to their learning and develop the attributes of high performers - curiosity, persistence and hard work, for example an approach Eyre calls 'high performance learning'. Critically, they need the right support in developing those approaches at home as well as at school.\n\nProf Anders Ericsson, an eminent education psychologist at Florida State University, US, is the co-author of Peak: Secrets from the New Science of Expertise.After research going back to 1980 into diverse achievements, from music to memory to sport, he doesn't think unique and innate talents are at the heart of performance.Deliberate practice, that stretches you every step of the way, and around 10,000 hours of it, is what produces the goods.It's not a magic number - the highest performers move on to doing a whole lot more, of course.Ericsson's memory research is particularly interesting because random students, trained in memory techniques for the study, went on to outperform others thought to have innately superior memories - those who you might call gifted.\n\nBut it is perhaps the work of Benjamin Bloom, another distinguished American educationist working in the 1980s, that gives the most pause for thought.Bloom's team looked at a group of extraordinarily high achieving people in disciplines as varied as ballet, swimming, piano, tennis, maths, sculpture and neurology. He found a pattern of parents encouraging and supporting their children, often in areas they enjoyed themselves. Bloom's outstanding people had worked very hard and consistently at something they had become hooked on when at a young age, and their parents all emerged as having strong work ethics themselves.\n\nEyre says we know how high performers learn.From that she has developed a high performing learning approach.She is working on this with a group of schools, both in Britain and abroad.Some spin-off research, which looked in detail at 24 of the 3,000 children being studied who were succeeding despite difficult circumstances, found something remarkable.Half were getting free school meals because of poverty, more than half were living with a single parent, and four in five were living in disadvantaged areas.Interviews uncovered strong evidence of an adult or adults in the child's life who valued and supported education, either in the immediate or extended family or in the child's wider community.Children talked about the need to work hard at school, to listen in class and keep trying.\n\nLet us end with Einstein, the epitome of a genius.He clearly had curiosity, character and determination. He struggled against rejection in early life but was undeterred.Did he think he was a genius or even gifted?He once wrote: 'It's not that I'm so smart, it's just that I stay with problems longer.Most people say it is the intellect which makes a great scientist. They are wrong: it is character.'"
                  },
                  {
                    "partTitle": "Questions 27-32",
                    "type": "html_template",
                
                     "instructions": "Complete the summary using the list of phrases, A-K, below.<br>Write the correct letter, A-K, in the boxes.",
                    "html_template": `
                        <div class="matching-options-box">
                            <ul>
                   
                             <li><strong>A</strong> appeal</li>
                                <li><strong>B</strong> determined</li>
                                <li><strong>C</strong> intrigued</li>
                    
                             <li><strong>D</strong> single</li>
                                <li><strong>E</strong> achievement</li>
                                <li><strong>F</strong> devoted</li>
                     
                           <li><strong>G</strong> involved</li>
                                <li><strong>H</strong> unique</li>
                                <li><strong>I</strong> innovative</li>
                      
                           <li><strong>J</strong> satisfaction</li>
                                <li><strong>K</strong> intent</li>
                            </ul>
                        </div>
    
                         <h4>Maryam Mirzakhani</h4>
                        <p>Maryam Mirzakhani is regarded as <strong>27</strong> [BLANK_27] in the field of mathematics because she was the only female holder of the prestigious Fields Medal - a record that she retained at the time of her death.
 However, maths held little <strong>28</strong> [BLANK_28] for her as a child and in fact her performance was below average until she was <strong>29</strong> [BLANK_29] by a difficult puzzle that one of her siblings showed her.</p>
                        <p>Later, as a professional mathematician, she had an inquiring mind and proved herself to be <strong>30</strong> [BLANK_30] when things did not go smoothly.
 She said she got the greatest <strong>31</strong> [BLANK_31] from making ground-breaking discoveries and in fact she was responsible for some extremely <strong>32</strong> [BLANK_32] mathematical studies.</p>`,
                    "questions": [
                      {"id": 27, "answer": "H", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]},
                
                       {"id": 28, "answer": "A", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]},
                      {"id": 29, "answer": "C", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]},
                      {"id": 30, "answer": "B", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", 
 "J", "K"]},
                      {"id": 31, "answer": "J", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]},
                      {"id": 32, "answer": "I", "type": "select", "options": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"]}
                    ]
 
                   },
                  {
                    "partTitle": "Questions 33-37",
                    "type": "single_question_list",
                    "instructions": "Do  the following statements agree with the claims of the writer in Reading Passage 3?<br>Write <strong>YES</strong>, <strong>NO</strong>, or <strong>NOT GIVEN</strong>.",
                    "questions": [
                      {"id": 33, "questionText": "33. Many people who ended up winning prestigious intellectual prizes only reached an average standard when young.", "options": ["YES", "NO", "NOT GIVEN"], "answer": "YES"},
                      {"id": 34, "questionText": "34. Einstein's failures as a young man were due to his lack of confidence.", "options": ["YES", "NO", "NOT GIVEN"], "answer": "NOT GIVEN"},
                      {"id": 35, "questionText": "35. It is difficult to reach agreement on whether some children are actually born gifted.", "options": ["YES", "NO", "NOT GIVEN"], "answer": "YES"},
                      {"id": 36, "questionText": "36. Einstein was upset by the public's view of his life's work.", "options": ["YES", "NO", "NOT GIVEN"], "answer": "NOT GIVEN"},
                      {"id": 37, "questionText": "37. Einstein put his success down to the speed at which he dealt with scientific questions.", "options": ["YES", "NO", "NOT GIVEN"], "answer": "NO"}
                    ]
                  },
                  {
                    "partTitle": "Questions 38-40",
 
                     "type": "single_question_list",
                    "instructions": "Choose the correct letter, A, B, C or D.",
                    "questions": [
                      {"id": 38, "questionText": "38. What does Eyre believe is needed for children to equal 'gifted' standards?", "options": ["A. strict discipline from the teaching staff", "B. assistance from their peers in the classroom", "C. the development of a spirit of inquiry towards their studies", "D. the determination to surpass everyone else's achievements"], "answer": "C"},
                      {"id": 39, "questionText": "39. What is the result of Ericsson's research?", "options": ["A. Very gifted students do not need to work on improving memory skills.", "B. Being born with a special gift is not the key factor in becoming expert.", "C. Including time for physical exercise is crucial in raising performance.", "D. 10,000 hours of relevant and demanding work will create a genius."], "answer": "B"},
                      {"id": 40, "questionText": "40. In the penultimate paragraph, it is stated the key to some deprived children's success is", "options": ["A. a regular and nourishing diet at home.", "B. the loving support of more than one parent.", "C. a community which has well-funded facilities for learning.", "D. the guidance of someone who recognises the benefits of learning."], "answer": "D"}
                    ]
                  }
                ]
              },
            
               "writing": {
                "title": "Writing",
                "timeLimit": 3600, // 60 minutes
                "parts": [
                  {
                    "partTitle": "WRITING TASK 1",
  
                   "instructions": "You should spend about 20 minutes on this task.<br>The plans below show a harbour in 2000 and how it looks today.<br>Summarise the information by selecting and reporting the main features, and make comparisons where relevant.<br>Write at least 150 words.",
                    "image": "images/writing_task1_cam19_t2.png",
                    "questions": [
                      {"id": 1, "type": "writing", "questionText": ""}
                    ]
       
                   },
                  {
                    "partTitle": "WRITING TASK 2",
                    "instructions": "You should spend about 40 minutes on this task.<br>Write about the following topic: The working week should be shorter and workers should have a longer weekend.<br>Do you agree or disagree? Give reasons for your answer and include any relevant examples from your own knowledge or experience.<br>Write at least 250 words.",
                    "questions": [
                      {"id": 2, "type": "writing", "questionText": ""}
                    ]
                  }
          
               ]
              }
            }
          ]
        
        };

        // --- DOM Element References ---
        const screens = {
            testSelection: document.getElementById('test-selection-screen'),
            infoForm: document.getElementById('info-form-screen'),
            sectionSelection: document.getElementById('section-selection-screen'),
            test: document.getElementById('test-screen'),
            result: document.getElementById('result-screen')
        };
        const testSetSelect = document.getElementById('test-set-select');
        const startTestBtn = document.getElementById('start-test-btn');
        const studentInfoForm = document.getElementById('student-info-form');
        const selectedTestName = document.getElementById('selected-test-name');
        const sectionTitle = document.getElementById('section-title');
        const questionNav = document.getElementById('question-navigation-bar');
        const questionArea = document.getElementById('question-area');
        const timerDisplay = document.getElementById('timer');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const restartBtn = document.getElementById('restart-btn');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const resultContainer = document.getElementById('result-content');
        
        // --- State Variables ---
        let testData = null,
            selectedTestSet = null,
            studentInfo = {},
            currentSection = '',
            currentPartIndex = 0,
            userAnswers = {},
            timerInterval;
        let sectionParts = [];
        let allQuestionsInSection = [];

        // --- Initialization ---
        loadTestData();
        
        // --- Functions ---
        function loadTestData() {
            testData = embeddedTestData;
            loadTestSets();
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenName]) screens[screenName].classList.remove('hidden');
        }

        function loadTestSets() {
            testSetSelect.innerHTML = '<option value="">-- Chn mt b  --</option>';
            if (testData && testData.testSets) {
                testData.testSets.forEach((testSet, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = testSet.setName;
                    testSetSelect.appendChild(option);
                });
            }
            testSetSelect.addEventListener('change', () => {
                if (testSetSelect.value) startTestBtn.classList.remove('hidden');
                else startTestBtn.classList.add('hidden');
            });
            showScreen('testSelection');
        }

        function startTest(section) {
            currentSection = section;
            currentPartIndex = 0;
            userAnswers = {};
            const sectionData = selectedTestSet[section];
            sectionParts = JSON.parse(JSON.stringify(sectionData.parts || []));
            allQuestionsInSection = [];

            questionNav.style.display = 'flex';
            document.getElementById('test-navigation').style.display = 'flex';
            prevBtn.style.display = 'inline-block';
            nextBtn.style.display = 'inline-block';
            submitBtn.style.display = 'inline-block';

            if (section === 'reading') {
                const processedParts = [];
                let currentPassage = null;
                sectionParts.forEach(part => {
                    if (part.passage) {
                        currentPassage = part.passage;
                    }
                    // *** FIX: Check for both 'questions' and 'matching_questions' properties ***
                    if ((part.questions && part.questions.length > 0) || (part.matching_questions && part.matching_questions.length > 0)) {
                        part.passage = currentPassage;
                        processedParts.push(part);
                    }
                });
                sectionParts = processedParts;
            }

            // Flatten all questions for easier scoring
            let flatQuestionId = 1;
            const tempSectionParts = (section === 'listening') ? selectedTestSet.listening.parts : sectionParts;
            tempSectionParts.forEach(part => {
                 const questionsSource = part.questions || (part.matching_questions ? [part] : []);
                 questionsSource.forEach(q => {
                    if (q.matching_questions) {
                        q.matching_questions.forEach(mq => {
                            allQuestionsInSection.push({ ...mq, globalId: flatQuestionId++ });
                        });
                    } else if (Array.isArray(q.id)) { 
                        allQuestionsInSection.push({ ...q, globalId: flatQuestionId++ });
                    } 
                    else if (q.id) {
                        allQuestionsInSection.push({ ...q, globalId: flatQuestionId++ });
                    }
                 });
            });
            
            showScreen('test');
            sectionTitle.textContent = sectionData.title;

            if (section === 'listening') {
                renderAllListeningParts();
            } else {
                renderCurrentPart();
            }
            startTimer(sectionData.timeLimit);
        }

        function renderCurrentPart() {
            if (currentPartIndex < 0 || currentPartIndex >= sectionParts.length) return;
            const partData = sectionParts[currentPartIndex];
            questionArea.innerHTML = '';
            audioPlayerContainer.innerHTML = '';

            let partStartIndex = 0;
            for (let i = 0; i < currentPartIndex; i++) {
                const part = sectionParts[i];
                if (part.questions) {
                    part.questions.forEach(q => {
                        if (q.matching_questions) {
                            partStartIndex += q.matching_questions.length;
                        } else if (Array.isArray(q.id)){
                            partStartIndex += 1;
                        } else {
                            partStartIndex += 1;
                        }
                    });
                } else if (part.matching_questions) {
                     partStartIndex += part.matching_questions.length;
                }
            }

            const partCard = createQuestionCard(partData, partStartIndex);
            questionArea.appendChild(partCard);

            renderPartNav();
            updateNavigationButtons();
        }
        
        function renderAllListeningParts() {
            questionNav.style.display = 'none';
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            audioPlayerContainer.innerHTML = ''; // Clear main audio container

            const listeningData = selectedTestSet.listening;
            questionArea.innerHTML = '';
            let globalQuestionIndex = 0;

            listeningData.parts.forEach(part => {
                const partCard = createQuestionCard(part, globalQuestionIndex);
                questionArea.appendChild(partCard);

                const questionsSource = part.questions || (part.matching_questions ? [part] : []);
                questionsSource.forEach(q => {
                   if (q.matching_questions) {
                        globalQuestionIndex += q.matching_questions.length;
                    } else if(Array.isArray(q.id)) {
                         globalQuestionIndex += 1;
                     } else if (q.id) {
                        globalQuestionIndex += 1;
                    }
                });
            });
        }


        function createQuestionCard(part, startIndex = 0) {
            const card = document.createElement('div');
            card.className = 'question-card';

            if (part.audio && currentSection === 'listening') {
                card.innerHTML += `<div class="audio-player-container-per-part" style="text-align:center; margin-bottom: 15px;">
                                      <p class="instructions">Bn s ch c nghe mt ln duy nht. Nhn play  bt u.</p>
                                      <audio controls style="width:100%;"><source src="${part.audio}" type="audio/mpeg">Trnh duyt ca bn khng h tr m thanh.</audio>
                                  </div>`;
            }

            if (part.partTitle) card.innerHTML += `<h3>${part.partTitle}</h3>`;
            if (part.passage) card.innerHTML += `<div class="passage">${part.passage}</div>`;
            if (part.image) card.innerHTML += `<img src="${part.image}" alt="Question Image" class="question-image">`;
            if (part.instructions) card.innerHTML += `<p class="instructions">${part.instructions}</p>`;

            let questionCounterInPart = 0;
            const questionsSource = part.questions || (part.matching_questions ? [part] : []);
            
            if (part.type === 'html_template') {
                let template = part.html_template;
                const container = document.createElement('div');
                container.className = 'html-template-container';

                part.questions.forEach((q) => {
                    const globalIndex = startIndex + questionCounterInPart;
                    const placeholder = `[BLANK_${q.id}]`;
                    
                    if (q.type === 'select') {
                        const optionsHtml = q.options.map(opt => `<option value="${opt}" ${userAnswers[globalIndex] === opt ? 'selected' : ''}>${opt}</option>`).join('');
                        template = template.replace(placeholder, `<select id="q_${globalIndex}" data-global-index="${globalIndex}"><option value="">-</option>${optionsHtml}</select>`);
                    } else {
                           template = template.replace(placeholder, `<input type="text" id="q_${globalIndex}" value="${userAnswers[globalIndex] || ''}" data-global-index="${globalIndex}" autocomplete="off">`);
                    }
                    questionCounterInPart++;
                });
                container.innerHTML = template;
                card.appendChild(container);
            } 
            else if (questionsSource.length > 0) {
                let lastInstructions = "";
                questionsSource.forEach(q_block => {
                    const questionElement = document.createElement('div');
                    questionElement.className = 'question-item';

                    if (q_block.instructions && q_block.instructions !== lastInstructions) {
                        questionElement.innerHTML += `<p class="instructions">${q_block.instructions}</p>`;
                        lastInstructions = q_block.instructions;
                    }
                    
                    if (q_block.type === 'matching_inline') {
                         let optionsBox = '<div class="matching-options-box"><ul>';
                        q_block.options.forEach(opt => { optionsBox += `<li>${opt.text}</li>`; });
                        optionsBox += '</ul></div>';
                        
                        questionElement.innerHTML += optionsBox;
                    }

                    if (q_block.questionText) {
                        questionElement.innerHTML += `<p><b>${q_block.questionText}</b></p>`;
                    }
                    
                    if (q_block.type === 'writing') {
                        const globalIndex = startIndex + questionCounterInPart;
                        questionElement.innerHTML += `<textarea id="q_${globalIndex}" data-global-index="${globalIndex}" class="writing-input" placeholder="Nhp cu tr li ca bn ti y...">${userAnswers[globalIndex] || ''}</textarea>`;
                        questionCounterInPart++;
                    }
                    else if (q_block.matching_questions) {
                        q_block.matching_questions.forEach(mq => {
                            const globalIndex = startIndex + questionCounterInPart;
                            const item = document.createElement('div');
                            item.className = 'matching-stem-item';
                            const optionsHtml = q_block.options.map(opt => `<option value="${opt.value}" ${userAnswers[globalIndex] === opt.value ? 'selected' : ''}>${opt.value}</option>`).join('');
                            item.innerHTML = `<label for="q_${globalIndex}">${mq.questionText}</label><select id="q_${globalIndex}" data-global-index="${globalIndex}"><option value="">Select</option>${optionsHtml}</select>`;
                            questionElement.appendChild(item);
                            questionCounterInPart++;
                        });
                    }
                    else if (q_block.options) {
                        const globalIndex = startIndex + questionCounterInPart;
                        const optionsContainer = document.createElement('div');
                        optionsContainer.className = 'options-container';
                        const inputType = q_block.multiSelect ? 'checkbox' : 'radio';
                        const questionId = Array.isArray(q_block.id) ? q_block.id.join('-') : q_block.id;

                        q_block.options.forEach(optionText => {
                            const optionValue = String(optionText).split('.')[0].trim();
                            const isChecked = Array.isArray(userAnswers[globalIndex]) ? userAnswers[globalIndex].includes(optionValue) : userAnswers[globalIndex] === optionValue;
                            optionsContainer.innerHTML += `<label><input type="${inputType}" name="q_${questionId}" value="${optionValue}" data-global-index="${globalIndex}" ${isChecked ? 'checked' : ''}> <span>${optionText}</span></label>`;
                        });
                        questionElement.appendChild(optionsContainer);
                        questionCounterInPart++;
                    }

                    if (questionElement.innerHTML.trim() !== "") {
                        card.appendChild(questionElement);
                    }
                });
            }

            card.querySelectorAll('input, select, textarea').forEach(el => {
                const index = parseInt(el.dataset.globalIndex, 10);
                if (isNaN(index)) return;
                
                const eventType = (el.type === 'text' || el.tagName.toLowerCase() === 'textarea') ? 'input' : 'change';
                
                el.addEventListener(eventType, (e) => {
                    if (e.target.type === 'checkbox') {
                        let answers = userAnswers[index] || [];
                       if (e.target.checked) {
                            if (!answers.includes(e.target.value)) answers.push(e.target.value);
                        } else {
                            answers = answers.filter(a  => a !== e.target.value);
                        }
                        userAnswers[index] = answers.sort();
                    } else {
                        userAnswers[index] = e.target.value;
                    }
                    
                    if (eventType === 'change' && currentSection !== 'listening') {
                        renderPartNav();
                    }
                });
                if ((el.type === 'text' || el.tagName.toLowerCase() === 'textarea') && currentSection !== 'listening') {
                     el.addEventListener('blur', renderPartNav);
                }
            });

            return card;
        }

        function renderPartNav() {
            questionNav.innerHTML = '';
            let questionCounter = 0;
            
            sectionParts.forEach((part, index) => {
                let numQuestionsInPart = 0;
                
                // *** FIX: Correctly count questions for all part types ***
                if (part.questions) {
                    part.questions.forEach(q => {
                        if (q.matching_questions) {
                             numQuestionsInPart += q.matching_questions.length;
                        } else if (Array.isArray(q.id)) {
                            numQuestionsInPart += 1;
                        } else {
                            numQuestionsInPart += 1;
                        }
                    });
                } else if (part.matching_questions) {
                    numQuestionsInPart = part.matching_questions.length;
                }

                const navBtn = document.createElement('button');
                navBtn.className = 'nav-q-btn';
                navBtn.textContent = part.partTitle;
                
                if (index === currentPartIndex) navBtn.classList.add('current');

                let allAnswered = numQuestionsInPart > 0;
                for (let i = 0; i < numQuestionsInPart; i++) {
                    const answer = userAnswers[questionCounter + i];
                    if (answer === undefined || answer === null || String(answer).trim() === '' || (Array.isArray(answer) && answer.length === 0)) {
                        allAnswered = false;
                        break;
                    }
                }
                if (allAnswered) navBtn.classList.add('answered');
                navBtn.onclick = () => {
                    currentPartIndex = index;
                    renderCurrentPart();
                };
                questionNav.appendChild(navBtn);
                questionCounter += numQuestionsInPart;
            });
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentPartIndex === 0;
            nextBtn.disabled = currentPartIndex >= sectionParts.length - 1;
            submitBtn.style.display = currentPartIndex >= sectionParts.length - 1 ? 'inline-block' : 'none';
        }

        function goNext() {
            if (currentPartIndex < sectionParts.length - 1) {
                currentPartIndex++;
                renderCurrentPart();
            }
        }

        function goPrev() {
            if (currentPartIndex > 0) {
                currentPartIndex--;
                renderCurrentPart();
            }
        }

        function startTimer(durationInSeconds) {
            clearInterval(timerInterval);
            let timer = durationInSeconds;
            timerInterval = setInterval(() => {
                if (!timerDisplay) return;
                const minutes = parseInt(timer / 60, 10);
                const seconds = parseInt(timer % 60, 10);
                timerDisplay.textContent = `Time: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
         
               if (--timer < 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    if (screens.test.classList.contains('hidden') === false) {
                      handleSubmit();
                    }
                }
            }, 1000);
        }
        
        function calculateScore() {
            if (currentSection === 'writing') {
                return { writingResponses: userAnswers };
            }

            let correctCount = 0;
            let incorrectCount = 0;
            let unansweredCount = 0;

            const resultDetails = allQuestionsInSection.map((question, index) => {
                const userAnswer = userAnswers[index];
                const correctAnswer = question.answer;
                const isCorrect = isAnswerCorrect(userAnswer, correctAnswer);

                if (userAnswer === undefined || userAnswer === null || (Array.isArray(userAnswer) && userAnswer.length === 0) || (typeof userAnswer === 'string' && userAnswer.trim() === '')) {
                    unansweredCount++;
                } else if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
                return {
                    questionNumber: question.id,
                    userAnswer: userAnswer,
                    correctAnswer: correctAnswer,
                    isCorrect: isCorrect
                };
            });
            return { correctCount, incorrectCount, unansweredCount, resultDetails };
        }
        
        function isAnswerCorrect(userAnswer, correctAnswer) {
            if (userAnswer === undefined || userAnswer === null) return false;
            const format = (ans) => String(ans).toLowerCase().trim().replace(/\.$/, '');
        
            if (Array.isArray(correctAnswer)) {
                if (!Array.isArray(userAnswer) || userAnswer.length !== correctAnswer.length) {
                    return false;
                }
                const sortedUserAnswer = [...userAnswer].map(format).sort();
                const sortedCorrectAnswer = [...correctAnswer].map(format).sort();
                return JSON.stringify(sortedUserAnswer) === JSON.stringify(sortedCorrectAnswer);
            } else {
                const user = format(userAnswer);
                const correct = format(correctAnswer);
                if (['true', 'false', 'not given', 'yes', 'no'].includes(correct)) {
                    return user.charAt(0) === correct.charAt(0);
                }
                return user === correct;
            }
        }

        function handleSubmit() {
            clearInterval(timerInterval);
            const scoreData = calculateScore();
            
            let feedbackHTML = `<h2>Results for ${selectedTestSet.setName} - ${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)}</h2>`;
            if (currentSection === 'writing') {
                feedbackHTML += `<p class="instructions">Your writing responses have been saved. Please copy them for submission.</p>`;
                Object.values(scoreData.writingResponses).forEach((response, index) => {
                    feedbackHTML += `
                        <div class="question-card">
                            <h3>Task ${index + 1} Response</h3>
                             <textarea class="writing-input" readonly>${response}</textarea>
                        </div>
                    `;
                });
            } else {
                 feedbackHTML += `
                    <div class="result-summary">
                        <p class="correct"><strong>Correct:</strong> ${scoreData.correctCount}</p>
                        <p class="incorrect"><strong>Incorrect:</strong> ${scoreData.incorrectCount}</p>
                       <p class="unanswered"><strong>Unanswered:</strong> ${scoreData.unansweredCount}</p>
                    </div>
                    <h3>Detailed Results</h3>
                    <table>
                         <thead>
                            <tr>
                                <th>Question</th>
                                <th>Your Answer</th>
                                <th>Correct Answer</th>
                                <th>Status</th>
                            </tr>
                         </thead>
                        <tbody>
                `;
                scoreData.resultDetails.forEach(detail => {
                    const status = detail.isCorrect ? '<span style="color: green; font-weight: bold;">Correct</span>' : (detail.userAnswer ? '<span style="color: red;">Incorrect</span>' : '<em>Unanswered</em>');
                    const userAnswerText = Array.isArray(detail.userAnswer) ? detail.userAnswer.join(', ') : (detail.userAnswer || '');
                    const correctAnswerText = Array.isArray(detail.correctAnswer) ? detail.correctAnswer.join(', ') : detail.correctAnswer;
                     const qNumberText = Array.isArray(detail.questionNumber) ? detail.questionNumber.join(' & ') : detail.questionNumber;

                    feedbackHTML += `
                        <tr>
                            <td>${qNumberText}</td>
                            <td>${userAnswerText}</td>
                            <td>${correctAnswerText}</td>
                            <td>${status}</td>
                     </tr>
                    `;
                });

                feedbackHTML += '</tbody></table>';
            }

            resultContainer.innerHTML = feedbackHTML;
            showScreen('result');
        }
        
        // --- Event Listeners ---
        startTestBtn.addEventListener('click', () => {
            const selectedIndex = testSetSelect.value;
            if (!selectedIndex) {
                alert('Vui lng chn mt b .');
                return;
             }
            selectedTestSet = testData.testSets[selectedIndex];
            selectedTestName.textContent = selectedTestSet.setName;
            showScreen('infoForm');
        });
        studentInfoForm.addEventListener('submit', (e) => {
            e.preventDefault();
            studentInfo = {
                fullName: e.target.fullName.value,
                className: e.target.className.value,
                dob: e.target.dob.value,
                phone: e.target.phone.value,
                 email: e.target.email.value
            };
            showScreen('sectionSelection');
        });
        document.querySelectorAll('#section-selection-screen .section-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const section = e.target.dataset.section;
                if (section && selectedTestSet) {
                    startTest(section);
                }
             });
        });
        
        restartBtn.addEventListener('click', () => location.reload());
        prevBtn.addEventListener('click', goPrev);
        nextBtn.addEventListener('click', goNext);
        submitBtn.addEventListener('click', handleSubmit);
    });
</script>
</body>
</html>